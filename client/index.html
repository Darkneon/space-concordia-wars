<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Space Concordia Wars</title>

    <!-- Sets initial viewport load and disables zooming  -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

    <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    
    <link href="lib/ratchet/css/ratchet.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://localhost:3000/socket.io/socket.io.js"></script>

    <!-- Include the compiled Ratchet JS -->
    <script src="lib/ratchet/js/ratchet.js"></script>      
    <script src="lib/dom.js"></script>     
    <script src="lib/phaser.js"></script>
    <script src="lib/markup.min.js"></script>
      
    <link href="components/join-room/css/join-room.css" rel="stylesheet">  
    <script src="components/join-room/join-room.js"></script>    
    <script src="components/new-room/new-room.js"></script>
    <script src="components/players-room/players-room.js"></script>
    <script src="games/iridescence/iridescence.js"></script>    
    <script src="games/mehdi-sez/mehdi-sez.js"></script>    
    <script src="games/tanks/tanks.js"></script>
    <script src="games/invaders/invaders.js"></script>
    <script src="games/snake/snake.js"></script>
    <script src="games/podium/podium.js"></script>
    <script src="lib/game-loader.js"></script>

    <script>
        $(document).ready(function() {
            var socket = io.connect('/');

            var newRoomComponent = new NewRoom({
                socket: socket,
                path: '/components/new-room', 
                elements: { 
                    content: '#new-room', 
                    nickname: '#nickname'
                },
                onNewRoomCreated: function(roomID, nickname) {
                    $.get('/getRooms', {}, function(result){
                        console.log(result);
                        for(var i = 0; i < result.length; i++) {
                            console.log(result[i]);
                        }
                    }, 'json');
                    
                    $.get('/getRoom/' + roomID, {}, function(result) {
                        console.log(result);
                        $('#join-room').hide();
                        $('#new-room').hide();
                        var playersRoomComponent = new PlayersRoom({
                            socket: socket, 
                            path: '/components/players-room',
                            nickname: nickname,
                            roomID: roomID,
                            roomName: result.roomName,
                            players: result.players,
                            elements: {
                                content: '#players-room'
                            }
                        });
                    }, 'json');
                }
                
            });
            
            var joinGameComponent = new JoinRoom({
                socket: socket,
                path: '/components/join-room', 
                elements: {
                    content: '#join-room',
                    nickname: '#nickname',
                    modal: '#modal'
                },
                onJoined: function(roomID, nickname) {
                    $('#join-room').hide();
                    $('#new-room').hide();

                    $.get('/getRoom/' + roomID, {}, function(result) {
                        $('#join-room').hide();
                        $('#new-room').hide();
                        var playersRoomComponent = new PlayersRoom({
                            socket: socket,
                            path: '/components/players-room',
                            nickname: nickname,
                            roomID: roomID,
                            roomName: result.roomName,
                            players: result.players,
                            elements: {
                                content: '#players-room'
                            }
                        });
                    }, 'json');
                }
            });
                        
            var COMMON_PATH = '/games/common';

            $('#game1').on('click', function() {
                $('body').html('<div id="theGame"></div>');
                var iridescence = new Iridescence({ commonPath: COMMON_PATH, path: '/games/iridescence'});
            });
            
            $('#game2').on('click', function() {
                $('body').html('<div id="theGame"></div>');
                var m = new MehdiSez({ commonPath: COMMON_PATH, path: '/games/mehdi-sez'});
            });

            $('#game3').on('click', function() {
                $('body').html('<div id="theGame"></div>');
                var m = new Tanks({ commonPath: COMMON_PATH, path: '/games/tanks'});
            });

            $('#game4').on('click', function() {
                $('body').html('<div id="theGame"></div>');
                var m = new Invaders({ commonPath: COMMON_PATH, path: '/games/invaders'});
            });

            $('#game5').on('click', function() {
                $('body').html('<div id="theGame"></div>');
                var m = new Snake({ commonPath: COMMON_PATH, path: '/games/snake'});
            });

            var gameLoader = new GameLoader({
                socket: socket,
                games: {
                    iridescence: {
                        constructor: Iridescence,
                        options: { socket: socket, commonPath: COMMON_PATH, path: '/games/iridescence' }
                    },
                    mehdisez: {
                        constructor: MehdiSez,
                        options: { commonPath: COMMON_PATH, path: '/games/mehdi-sez' }
                    },
                    tanks: {
                        constructor: Tanks,
                        options: { commonPath: COMMON_PATH, path: '/games/tanks' }
                    },
                    invaders: {
                        constructor: Invaders,
                        options: { commonPath: COMMON_PATH, path: '/games/invaders' }
                    }
                }
            });

//            $('#game4').on('click', function() {
//                $('body').html('<div id="theGame"></div>');
//                var m = new Podium({ commonPath: COMMON_PATH, path: '/games/podium'});
//            });

        });
    </script>
  </head>
  <body>

    <!-- Make sure all your bars are the first things in your <body> -->
    
    <header class="bar bar-nav">
      <h1 class="title">Space Concordia Wars</h1>
    </header>
    
    <div id="modal" class="modal"></div>      
      
    <div class="content">            
        <input id='nickname' type="text" placeholder="Nickname" />        
        <div id='new-room'></div>         
        <div id='join-room'></div>         
        <a id='game1' class="btn btn-positive btn-block">Test Game #1</a>
        <a id='game2' class="btn btn-positive btn-block">Test Game #2</a>
        <a id='game3' class="btn btn-positive btn-block">Test Game #3</a>
        <a id='game4' class="btn btn-positive btn-block">Test Game #4</a>
        <a id='game5' class="btn btn-positive btn-block">Test Game #5</a>
        <!--<a id='game4' class="btn btn-positive btn-block">Test Game #4</a>-->

        <div id='players-room' class="card"></div>            
    </div>

  </body>
</html>